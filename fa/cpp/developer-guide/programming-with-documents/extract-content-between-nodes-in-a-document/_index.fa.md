---
title: نحوه استخراج محتوا بین گره های سند
second_title: Aspose.Words برای C++
articleTitle: استخراج محتوا بین گره ها در یک سند
linktitle: استخراج محتوا بین گره ها
type: docs
description: "استخراج محتوای سند در متفاوت با استفاده از C++."
weight: 140
url: /fa/cpp/how-to-extract-selected-content-between-nodes-in-a-document/
timestamp: 2024-01-27-14-07-04
---

هنگام کار با اسناد، مهم است که بتوانید به راحتی محتوای یک محدوده خاص را در یک سند استخراج کنید. با این حال، محتوا ممکن است شامل عناصر پیچیده ای مانند پاراگراف ها، جداول، تصاویر و غیره باشد.

صرف نظر از اینکه چه محتوایی باید استخراج شود، روش استخراج آن محتوا همیشه تعیین می شود که کدام گره ها برای استخراج محتوا بین آنها انتخاب می شوند. این می تواند کل متن بدن و یا متن ساده اجرا می شود.

موقعیت های احتمالی زیادی وجود دارد و بنابراین انواع گره های مختلفی برای استخراج محتوا وجود دارد. برای مثال، ممکن است بخواهید محتوای بین:

- دو پاراگراف خاص
- اجراهای خاص متن
- زمینه های مختلف مانند زمینه های ادغام
- محدوده شروع و پایان یک نشانه یا نظر
- مجموعه های مختلف متن موجود در بخش های جداگانه

در برخی شرایط، حتی ممکن است لازم باشد انواع گره های مختلف مانند استخراج محتوا بین یک پاراگراف و یک فیلد یا بین یک اجرا و یک نشانه را ترکیب کنید.

این مقاله پیاده سازی کد برای استخراج متن بین گره های مختلف و همچنین نمونه هایی از سناریوهای رایج را ارائه می دهد.

{{% alert color="primary" %}}

این نمونه ها فقط چند نمایش از امکانات بسیاری است. ما برنامه ریزی می کنیم که قابلیت استخراج متن در آینده بخشی از API عمومی باشد و هیچ کد اضافی مورد نیاز نخواهد بود. در این میان، درخواست های خود را در مورد این قابلیت در [Aspose.Words انجمن](https://forum.aspose.com/c/words/8).

{{% /alert %}}

## چرا محتوا را استخراج کنیم

اغلب هدف از استخراج محتوا این است که آن را به طور جداگانه در یک سند جدید تکرار یا ذخیره کنید. به عنوان مثال، شما می توانید محتوا را استخراج کنید و:

- آن را در یک سند جداگانه کپی کنید
- تبدیل یک قسمت خاص از یک سند به PDF یا تصویر
- محتوای موجود در سند را بارها تکرار کنید
- کار با محتوای استخراج شده جدا از بقیه سند

این کار را می توان با استفاده از Aspose.Words و پیاده سازی کد زیر به راحتی انجام داد.

## الگوریتم استخراج محتوا

کد در این بخش به تمام موقعیت های احتمالی که در بالا توضیح داده شد با یک روش عمومی و قابل استفاده مجدد می پردازد. طرح کلی این تکنیک شامل:

1. جمع آوری گره هایی که منطقه محتوایی را که از سند شما استخراج می شود، تعیین می کند. بازیابی این گره ها توسط کاربر در کد آنها بر اساس آنچه که می خواهند استخراج شوند، انجام می شود.
1. انتقال این گره ها به روش **ExtractContent** ارائه شده در زیر. شما همچنین باید یک پارامتر بولی را عبور دهید که بیان می کند آیا این گره ها، به عنوان نشانگر عمل می کنند، باید در استخراج گنجانده شوند یا نه.
1. بازیابی لیستی از محتوای کلون شده (گره های کپی شده) مشخص شده برای استخراج. شما می توانید از این لیست گره ها به هر روش قابل اجرا استفاده کنید، به عنوان مثال، ایجاد یک سند جدید که فقط حاوی محتوای انتخاب شده است.

## نحوه استخراج محتوا

برای استخراج محتوا از سند خود باید روش `ExtractContent` زیر را فراخوانی کنید و پارامترهای مناسب را منتقل کنید. اساس اساسی این روش شامل یافتن گره های سطح بلوک (پاراگراف ها و جداول) و شبیه سازی آنها برای ایجاد نسخه های یکسان است. اگر گره های نشانگر عبور شده در سطح بلوک باشند، روش می تواند به سادگی محتوای آن سطح را کپی کند و آن را به آرایه اضافه کند.

با این حال، اگر گره های نشانگر خطی باشند (فرزند یک پاراگراف)، وضعیت پیچیده تر می شود، زیرا لازم است پاراگراف را در گره خطی تقسیم کنید، چه اجرا شود، زمینه های نشانه گذاری و غیره. محتوای در گره های والدین کلون شده که بین نشانگرها وجود ندارد حذف می شود. این فرآیند برای اطمینان از اینکه گره های خطی هنوز قالب بندی پاراگراف اصلی را حفظ می کنند، استفاده می شود. این روش همچنین چک هایی را در گره های منتقل شده به عنوان پارامترها اجرا می کند و اگر هر یک از گره ها نامعتبر باشد، یک استثنا را پرتاب می کند. پارامترهایی که باید به این روش منتقل شوند عبارتند از:

1. **StartNode** و **EndNode**. دو پارامتر اول گره هایی هستند که تعریف می کنند که استخراج محتوا به ترتیب در کجا شروع و پایان می یابد. این گره ها می توانند هم سطح بلوک (پاراگراف، جدول ) و هم سطح خطی (به عنوان مثال Run، FieldStart، BookmarkStart و غیره) باشند.):
   1. برای عبور از یک فیلد باید از شیء **FieldStart** مربوطه عبور کنید.
   1. برای عبور از نشانه ها، گره های **BookmarkStart** و BookmarkEnd باید منتقل شوند.
   1. برای عبور از نظرات، باید از گره های CommentRangeStart و CommentRangeEnd استفاده شود.
1. **IsInclusive**. مشخص می کند که آیا نشانگرها در استخراج گنجانده شده اند یا نه. اگر این گزینه به false تنظیم شود و همان گره یا گره های متوالی منتقل شوند، یک لیست خالی بازگردانده می شود:

      1. اگر یک گره **FieldStart** منتقل شود، این گزینه تعریف می کند که آیا کل فیلد باید شامل یا حذف شود.
      1. اگر یک گره **BookmarkStart** یا **BookmarkEnd** منتقل شود، این گزینه تعریف می کند که آیا علامت گذاری شامل شده است یا فقط محتوای بین محدوده علامت گذاری است.
      1. اگر یک گره **CommentRangeStart** یا **CommentRangeEnd** منتقل شود، این گزینه تعریف می کند که آیا خود نظر باید شامل شود یا فقط محتوای در محدوده نظر.

پیاده سازی روش **ExtractContent** که می توانید پیدا کنید [اینجا](https://github.com/aspose-words/Aspose.Words-for-C/blob/master/Examples/DocsExamples/source/Programming%20with%20Documents/Contents%20Management/Extract%20content%20helper.h). این روش در سناریوهای این مقاله ذکر خواهد شد.

ما همچنین یک روش سفارشی برای تولید آسان یک سند از گره های استخراج شده تعریف خواهیم کرد. این روش در بسیاری از سناریوهای زیر استفاده می شود و به سادگی یک سند جدید ایجاد می کند و محتوای استخراج شده را وارد آن می کند.

مثال کد زیر نشان می دهد که چگونه یک لیست از گره ها را بگیرید و آنها را در یک سند جدید قرار دهید.

{{< gist "aspose-words-gists" "922a9c5d9606a0c5cf0682b4aadfaf29" "generate-document.h" >}}

## استخراج محتوا بین پاراگراف ها

این نشان می دهد که چگونه از روش بالا برای استخراج محتوا بین پاراگراف های خاص استفاده کنید. در این حالت می خواهیم بدنه نامه موجود در نیمه اول سند را استخراج کنیم. ما می توانیم بگوییم که این بین پاراگراف های 7و 11 است.

کد زیر این کار را انجام می دهد. پاراگراف های مناسب با استفاده از روش [GetChild](https://reference.aspose.com/words/cpp/aspose.words/compositenode/getchild/) در سند استخراج می شوند و شاخص های مشخص شده را منتقل می کنند. سپس این گره ها را به روش **ExtractContent** منتقل می کنیم و بیان می کنیم که این ها باید در استخراج گنجانده شوند. این روش محتوای کپی شده بین این گره ها را که سپس در یک سند جدید وارد می شوند، باز می گرداند.

مثال کد زیر نشان می دهد که چگونه محتوای بین پاراگراف های خاص را با استفاده از روش `ExtractContent` بالا استخراج کنیم:

{{< gist "aspose-words-gists" "922a9c5d9606a0c5cf0682b4aadfaf29" "extract-content-between-paragraphs.h" >}}

## استخراج محتوا بین انواع مختلف گره ها

ما می توانیم محتوا را بین هر ترکیبی از گره های سطح بلوک یا خطی استخراج کنیم. در این سناریو زیر ما محتوای بین پاراگراف اول و جدول در بخش دوم را به طور کامل استخراج خواهیم کرد. ما گره های نشانگر را با فراخوانی روش `Body.FirstParagraph` و [GetChild](https://reference.aspose.com/words/cpp/aspose.words/compositenode/getchild/) در بخش دوم سند برای بازیابی گره های پاراگراف و جدول مناسب دریافت می کنیم. برای یک تغییر کوچک بیایید به جای آن محتوای را تکرار کنیم و آن را زیر اصل قرار دهیم.

مثال کد زیر نشان می دهد که چگونه محتوای بین یک پاراگراف و جدول را با استفاده از روش `ExtractContent` استخراج کنیم:

{{< gist "aspose-words-gists" "922a9c5d9606a0c5cf0682b4aadfaf29" "extract-content-between-block-level-nodes.h" >}}

## استخراج محتوا بین پاراگراف ها بر اساس سبک

ممکن است لازم باشد محتوای بین پاراگراف های سبک های مشابه یا متفاوت مانند بین پاراگراف هایی که با سبک های عنوان مشخص شده اند را استخراج کنید. کد زیر نشان می دهد که چگونه این کار را انجام دهید. این یک مثال ساده است که محتوای بین اولین نمونه از سبک های "Heading 1" و "Header 3" را بدون استخراج عناوین نیز استخراج می کند. برای انجام این کار ما آخرین پارامتر را به false تنظیم می کنیم، که مشخص می کند که گره های نشانگر نباید شامل شوند.

در یک پیاده سازی مناسب، این باید در یک حلقه اجرا شود تا محتوای بین تمام پاراگراف های این سبک ها از سند استخراج شود. محتوای استخراج شده در یک سند جدید کپی می شود.

مثال کد زیر نشان می دهد که چگونه محتوای بین پاراگراف ها را با سبک های خاص با استفاده از روش `ExtractContent` استخراج کنیم:

{{< gist "aspose-words-gists" "922a9c5d9606a0c5cf0682b4aadfaf29" "extract-content-between-paragraph-styles.h" >}}

{{< gist "aspose-words-gists" "922a9c5d9606a0c5cf0682b4aadfaf29" "paragraphs-by-style-name.h" >}}

## استخراج محتوا بین اجراهای خاص

شما می توانید محتوای بین گره های خطی مانند [Run](https://reference.aspose.com/words/cpp/aspose.words/run/) را نیز استخراج کنید. **Runs** از پاراگراف های مختلف می تواند به عنوان نشانگر منتقل شود. کد زیر نشان می دهد که چگونه متن خاص را بین همان گره **Paragraph** استخراج کنیم.

مثال کد زیر نشان می دهد که چگونه محتوای بین اجراهای خاص همان پاراگراف را با استفاده از روش **ExtractContent** استخراج کنیم:

{{< gist "aspose-words-gists" "922a9c5d9606a0c5cf0682b4aadfaf29" "extract-content-between-runs.h" >}}

## استخراج محتوا با استفاده از یک فیلد

برای استفاده از یک فیلد به عنوان نشانگر، گره `FieldStart` باید منتقل شود. آخرین پارامتر به روش `ExtractContent` تعریف خواهد کرد که آیا کل فیلد باید شامل شود یا نه. بیایید محتوای بین فیلد ادغام "FullName" و یک پاراگراف در سند را استخراج کنیم. ما از روش [MoveToMergeField](https://reference.aspose.com/words/cpp/aspose.words/documentbuilder/movetomergefield/) کلاس [DocumentBuilder](https://reference.aspose.com/words/cpp/aspose.words/documentbuilder/) استفاده می کنیم. این گره **FieldStart** را از نام فیلد ادغام به آن منتقل می کند.

در مورد ما بیایید آخرین پارامتر منتقل شده به روش **ExtractContent** را به false تنظیم کنیم تا فیلد را از استخراج حذف کنیم. ما محتوای استخراج شده را به PDF ارائه خواهیم داد.

مثال کد زیر نشان می دهد که چگونه محتوای بین یک فیلد خاص و پاراگراف در سند با استفاده از روش **ExtractContent** استخراج شود:

{{< gist "aspose-words-gists" "922a9c5d9606a0c5cf0682b4aadfaf29" "extract-content-using-field.h" >}}

## استخراج محتوا از یک نشانک

در یک سند، محتوایی که در یک نشانه تعریف شده است توسط گره های `BookmarkStart` و BookmarkEnd بسته بندی شده است. محتوای موجود بین این دو گره نشانک را تشکیل می دهد. شما می توانید هر یک از این گره ها را به عنوان هر نشانگر، حتی آنهایی که از نشانه های مختلف هستند، عبور دهید، تا زمانی که نشانگر شروع قبل از نشانگر پایان در سند ظاهر شود. ما این محتوا را با استفاده از کد زیر به یک سند جدید استخراج خواهیم کرد. گزینه پارامتر **IsInclusive** نشان می دهد که چگونه علامت گذاری را حفظ یا دور بریزید.

مثال کد زیر نشان می دهد که چگونه محتوای ارجاع شده را با استفاده از روش **ExtractContent** استخراج کنیم:

{{< gist "aspose-words-gists" "922a9c5d9606a0c5cf0682b4aadfaf29" "extract-content-between-bookmark.h" >}}

## استخراج مطالب از یک نظر

یک نظر از گره های CommentRangeStart، CommentRangeEnd و نظر تشکیل شده است. همه این گره ها خطی هستند. دو گره اول محتوای سند را که توسط نظر ارجاع داده شده است، همانطور که در تصویر زیر دیده می شود، خلاصه می کند.

خود گره **Comment** یک InlineStory است که می تواند شامل پاراگراف ها و اجرا شود. این پیام نظر را به عنوان یک حباب نظر در صفحه پیش نمایش نشان می دهد. از آنجا که این گره خطی است و از نسل یک بدن است شما همچنین می توانید محتوای داخل این پیام را نیز استخراج کنید.

این نظر عنوان، پاراگراف اول و جدول را در بخش دوم خلاصه می کند. بیایید این نظر را به یک سند جدید تبدیل کنیم. گزینه **IsInclusive** تعیین می کند که آیا خود نظر حفظ شده یا رد شده است.

مثال کد زیر نشان می دهد که چگونه این کار را انجام دهید:

{{< gist "aspose-words-gists" "922a9c5d9606a0c5cf0682b4aadfaf29" "extract-content-between-comment-range.h" >}}

## نحوه استخراج محتوا با استفاده از DocumentVisitor

برای اجرای این سناریوی استفاده از کلاس [DocumentVisitor](https://reference.aspose.com/words/cpp/aspose.words/documentvisitor/) استفاده کنید. این کلاس با الگوی طراحی بازدید کننده شناخته شده مطابقت دارد. با **DocumentVisitor,** می توانید عملیات سفارشی را که نیاز به شمارش بر روی درخت سند دارند تعریف و اجرا کنید.

**DocumentVisitor**

هر روش **DocumentVisitor.VisitXXX** یک مقدار [VisitorAction](https://reference.aspose.com/words/net/aspose.words/visitoraction/) را باز می گرداند که شمارش گره ها را کنترل می کند. شما می توانید درخواست کنید که یا شمارش را ادامه دهید، گره فعلی را حذف کنید (اما شمارش را ادامه دهید)، یا شمارش گره ها را متوقف کنید.

این گام هایی است که باید برای تعیین و استخراج بخش های مختلف یک سند به صورت برنامه ریزی شده دنبال کنید:

- یک کلاس مشتق از **DocumentVisitor**ایجاد کنید
- رد کردن و ارائه پیاده سازی برای برخی یا همه روش های **DocumentVisitor.VisitXXX** برای انجام برخی از عملیات سفارشی
- `Node.Accept` را در گره ای که می خواهید شمارش را از آن شروع کنید، فراخوانی کنید. به عنوان مثال، اگر می خواهید کل سند را فهرست کنید، از `Document.Accept`استفاده کنید

**DocumentVisitor**

این مثال نشان می دهد که چگونه از الگوی بازدید کننده برای اضافه کردن عملیات جدید به مدل شیء Aspose.Words استفاده کنیم. در این حالت، ما یک مبدل سند ساده به قالب متن ایجاد می کنیم:

{{< gist "aspose-words-gists" "922a9c5d9606a0c5cf0682b4aadfaf29" "extract-content-using-document-visitor.h" >}}

{{< gist "aspose-words-gists" "922a9c5d9606a0c5cf0682b4aadfaf29" "convert-doc-to-txt.h" >}}

{{% alert color="primary" %}}

شما می توانید فایل نمونه این مثال را از [Aspose.Words GitHub](https://github.com/aspose-words/Aspose.Words-for-C/tree/master/Examples).

{{% /alert %}}

## نحوه استخراج متن فقط

راه های بازیابی متن از سند عبارتند از:

- از [Document.Save](https://reference.aspose.com/words/cpp/aspose.words/document/save/) با [SaveFormat.Text](https://reference.aspose.com/words/cpp/aspose.words/saveformat/) برای ذخیره به عنوان متن ساده در یک فایل یا جریان استفاده کنید
- از [Node.ToString](https://reference.aspose.com/words/cpp/aspose.words/node/tostring/) استفاده کنید و پارامتر **SaveFormat.Text** را منتقل کنید. در داخل، این save as text را به یک جریان حافظه فرا می خواند و رشته حاصل را باز می گرداند
- برای بازیابی متن با تمام کاراکترهای کنترل Microsoft Word از جمله کدهای فیلد از [Node.GetText](https://reference.aspose.com/words/cpp/aspose.words/node/gettext/) استفاده کنید
- پیاده سازی یک [DocumentVisitor](https://reference.aspose.com/words/cpp/aspose.words/documentvisitor/) سفارشی برای انجام استخراج سفارشی

### با استفاده از `Node.GetText` و `Node.ToString`

یک سند ورد می تواند شامل کاراکترهای کنترل باشد که عناصر خاصی مانند فیلد، انتهای سلول، انتهای بخش و غیره را تعیین می کند. لیست کامل کاراکترهای کنترل کلمه ممکن در کلاس [ControlChar](https://reference.aspose.com/words/cpp/aspose.words/controlchar/) تعریف شده است. روش **Node.GetText** متن را با تمام کاراکترهای کاراکتر کنترل موجود در گره باز می گرداند.

فراخوانی **ToString** نمایش متن ساده سند را تنها بدون کاراکترهای کنترل باز می گرداند.

مثال کد زیر تفاوت بین فراخوانی روش های **GetText** و **ToString** در یک گره را نشان می دهد:

{{< gist "aspose-words-gists" "922a9c5d9606a0c5cf0682b4aadfaf29" "simple-extract-text.h" >}}

### با استفاده از `SaveFormat.Text`

این مثال سند را به شرح زیر ذخیره می کند:

- فیلتر کردن کاراکترهای فیلد و کدهای فیلد، شکل، زیرنویس، پایان نامه و مرجع نظرات
- کاراکترهای پایان پاراگراف **ControlChar.Cr** را با ترکیب **ControlChar.CrLf** جایگزین می کند
- از کدگذاری UTF8 استفاده می کند

مثال کد زیر نشان می دهد که چگونه یک سند را در فرمت TXT ذخیره کنید:

{{< gist "aspose-words-gists" "922a9c5d9606a0c5cf0682b4aadfaf29" "docx-to-txt.h" >}}

## استخراج تصاویر از اشکال

ممکن است برای انجام برخی کارها نیاز به استخراج تصاویر سند داشته باشید. Aspose.Words به شما اجازه می دهد این کار را نیز انجام دهید.

مثال کد زیر نشان می دهد که چگونه تصاویر را از یک سند استخراج کنید:

{{< gist "aspose-words-gists" "922a9c5d9606a0c5cf0682b4aadfaf29" "extract-images.h" >}}
