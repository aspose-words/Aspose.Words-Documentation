---
title: Работа с оглавлением в C#
second_title: Aspose.Words для .NET
articleTitle: Работа с оглавлением
linktitle: Работа с оглавлением
description: "Подробное описание поля Оглавление. Как создать и изменить поле `TOC` с помощью C#. Вставьте `TOC` C#."
type: docs
weight: 170
url: /ru/net/working-with-table-of-contents/
---

Часто вам придется работать с документами, содержащими оглавление (TOC). С помощью Aspose.Words вы можете вставить собственное оглавление или полностью перестроить существующее оглавление в документе, используя всего несколько строк кода. В этой статье описывается, как работать с полем оглавления, и демонстрируется:

- Как вставить новенький `TOC`
- Обновить новые или существующие оглавления в документе.
- Укажите переключатели для управления форматированием и общей структурой оглавления.
- Как изменить стили и внешний вид оглавления.
- Как удалить все поле `TOC` вместе со всеми записями из документа.

## Вставить оглавление программно

Вы можете вставить поле `TOC` (оглавление) в документ в текущую позицию, вызвав метод [InsertTableOfContents](https://reference.aspose.com/words/ru/net/aspose.words/documentbuilder/inserttableofcontents/).

Оглавление в документе Word можно построить разными способами и отформатировать с использованием различных параметров. Переключатели полей, которые вы передаете методу, управляют тем, как таблица строится и отображается в документе.

Переключателями по умолчанию, которые используются в `TOC`, вставленном в Microsoft Word, являются **"\o "1-3 \h \z \u"**. Описания этих переключателей, а также список поддерживаемых переключателей можно найти далее в статье. Вы можете либо использовать это руководство, чтобы получить правильные переключатели, либо, если у вас уже есть документ, содержащий аналогичный `TOC`, который вам нужен, вы можете показать коды полей (*ALT+F9*) и скопировать переключатели непосредственно из поля.

В следующем примере кода показано, как вставить поле "Оглавление" в документ:

{{< gist "aspose-words" "9a306a41bb6aea8adfcabf5a575c5718" "Examples-CSharp-Programming-Documents-Document-DocumentBuilderInsertTOC-DocumentBuilderInsertTOC.cs" >}}

В следующем примере кода показано, как вставить оглавление (TOC) в документ, используя стили заголовков в качестве записей.

{{< gist "aspose-words" "9a306a41bb6aea8adfcabf5a575c5718" "Examples-CSharp-Programming-Documents-Document-DocumentBuilderInsertElements-DocumentBuilderInsertTableOfContents.cs" >}}

{{% alert color="primary" %}}

Без методов, использованных в примере, при открытии выходного документа вы обнаружите поле `TOC`, но без видимого содержимого. Это связано с тем, что поле `TOC` было вставлено, но еще не заполнено, пока оно не будет обновлено в документе. Дополнительная информация об этом обсуждается в следующем разделе.

{{% /alert %}}

## Обновить оглавление

Aspose.Words позволяет полностью обновить `TOC` всего несколькими строками кода. Это можно сделать для заполнения вновь вставленного `TOC` или для обновления существующего `TOC` после внесения изменений в документ. Для обновления полей `TOC` в документе необходимо использовать следующие два метода:

1. [UpdateFields](https://reference.aspose.com/words/ru/net/aspose.words/document/updatefields/)
1. [UpdatePageLayout](https://reference.aspose.com/words/ru/net/aspose.words/document/updatepagelayout/)

Обратите внимание, что эти два метода обновления необходимо вызывать в указанном порядке. В обратном случае оглавление будет заполнено, но номера страниц отображаться не будут. Может быть обновлено любое количество различных TOC. Эти методы автоматически обновят все оглавления, найденные в документе.

В следующем примере кода показано, как полностью перестроить `TOC` полей в документе, вызвав обновление полей:

{{< gist "aspose-words" "9a306a41bb6aea8adfcabf5a575c5718" "Examples-CSharp-Programming-Documents-Document-DocumentBuilderInsertTOC-UpdateFields.cs" >}}

Первый вызов **UpdateFields** создаст `TOC`, все текстовые записи будут заполнены, и `TOC` будет выглядеть почти завершенным. Единственное, чего не хватает, так это номеров страниц, которые пока отображаются со знаком "?". Второй вызов **UpdatePageLayout** создаст макет документа в памяти. Это необходимо сделать, чтобы собрать номера страниц записей. Правильные номера страниц, рассчитанные на основе этого вызова, затем вставляются в оглавление.

## Используйте переключатели для управления поведением таблицы содержания

Как и любое другое поле, поле `TOC` может принимать переключатели, определенные в коде поля, которые управляют построением оглавления. Некоторые переключатели используются для управления тем, какие записи включаются и на каком уровне, тогда как другие используются для управления внешним видом оглавления. Переключатели можно комбинировать вместе для создания сложной таблицы содержания.

![working-with-table-of-contents-aspose-words-net](/words/net/working-with-table-of-contents/working-with-table-of-contents-1.png)


По умолчанию эти переключатели, указанные выше, включаются при вставке в документ значения по умолчанию `TOC`. `TOC` без переключателей будет включать содержимое из встроенных стилей заголовков (как если бы установлен переключатель \O). Доступные переключатели `TOC`, поддерживаемые Aspose.Words, перечислены ниже, и их использование подробно описано. Их можно разделить на отдельные разделы в зависимости от их типа. Переключатели в первом разделе определяют, какой контент включать в `TOC`, а переключатели во втором разделе управляют внешним видом оглавления. Если коммутатор здесь не указан, значит, он в настоящее время не поддерживается. Все коммутаторы будут поддерживаться в будущих версиях. Мы добавляем дополнительную поддержку с каждым выпуском.

### Переключатели входной маркировки

|  Выключатель | Описание |
|  :-  |  :-  |
| **Heading Styles**<br>*(\O Переключатель)* | <p>Этот переключатель определяет, что `TOC` должен быть построен на основе встроенных стилей заголовков. В Microsoft Word они определяются заголовками 1 – 9. В Aspose.Words эти стили представлены соответствующим перечислением StyleIdentifier. Это перечисление представляет собой независимый от локали идентификатор стиля, например `StyleIdentifier.Heading1` представляет стиль заголовка 1. Благодаря этому форматирование и свойства стиля можно получить из коллекции Style документа. Соответствующий класс Style можно получить из коллекции `Document.Styles` с помощью индексированного свойства типа StyleIdentifier.</p>

<p>![working-with-table-of-contents-styles](/words/net/working-with-table-of-contents/working-with-table-of-contents-2.png)</p>
<p>Любой контент, отформатированный с помощью этих стилей, включается в оглавление. Уровень заголовка будет определять соответствующий иерархический уровень записи в оглавлении. Например, абзац со стилем "Заголовок 1" будет рассматриваться как первый уровень в `TOC`, тогда как абзац со стилем "Заголовок 2" будет рассматриваться как следующий уровень в иерархии и т.д.</p> |
| **Outline Levels**<br>*(\U переключатель)* | <p>Для каждого абзаца можно определить уровень структуры в разделе "Параметры абзаца".</p>

<p>![working-with-table-of-contents-paragraph](/words/net/working-with-table-of-contents/working-with-table-of-contents-3.png)</p>
<p>Этот параметр определяет, на каком уровне в иерархии документов следует рассматривать этот абзац. Это обычно используемая практика, позволяющая легко структурировать макет документа. Эту иерархию можно просмотреть, переключившись на "Структурный вид" в Microsoft Word. Как и в случае со стилями заголовков, в дополнение к уровню "Основной текст" может быть от 1 до 9 уровней структуры. Уровни структуры 1–9 появятся в `TOC` на соответствующем уровне иерархии.<br>Любой контент, уровень структуры которого установлен либо в стиле абзаца, либо непосредственно в самом абзаце, включается в оглавление. В Aspose.Words уровень структуры представлен свойством `ParagraphFormat.OutlineLevel` узла "Абзац". Уровень структуры стиля абзаца аналогичным образом представляется свойством `Style.ParagraphFormat`.</p>
<p>{{% alert color="primary" %}}</p>
<p>Обратите внимание, что встроенные стили заголовков, такие как "Заголовок 1", имеют обязательный уровень структуры, установленный в настройках стиля.</p>
<p>{{% /alert %}}</p> |
| **Custom Styles**<br>*(переключатель\T)* | <p>Этот переключатель позволит использовать пользовательские стили при сборе записей для использования в оглавлении. Это часто используется вместе с переключателем \O для включения пользовательских стилей вместе со встроенными стилями заголовков в оглавление.<br>Параметры переключателя должны быть заключены в речевые знаки. Можно включить множество пользовательских стилей. Для каждого стиля следует указать имя, за которым следует запятая, а затем уровень, на котором стиль должен отображаться в `TOC` как. Дальнейшие стили также разделяются запятой.<br>Например</p>

<p>{{< highlight csharp >}}

<p>  { TOC \o "1-3" \t "CustomHeading1, 1,   CustomHeading2, 2"} </p><p>{{< /highlight >}}</p>
<p>будет использовать контент, стилизованный с помощью CustomHeading1, как контент уровня 1 в `TOC`, а CustomHeading2 как контент уровня 2.</p> |
| **Use TC Fields**<br>*(переключатели \F и \L)* | <p>В старых версиях Microsoft Word единственным способом создания `TOC` было использование полей TC. Эти поля вставляются в документ скрытыми, даже если отображаются коды полей. Они включают в себя текст, который должен отображаться в записи, и на их основе строится число `TOC`. Эта функция сейчас используется не очень часто, но в некоторых случаях все же может быть полезна для включения в `TOC` записей, которые не имеют отступа, чтобы их было видно в документе.<br>При вставке эти поля кажутся скрытыми, даже если отображаются коды полей. Их невозможно увидеть без отображения скрытого содержимого. Чтобы увидеть эти поля, необходимо выбрать "Показать форматирование абзаца".</p>

<p>![working-with-table-of-contents-paragraph-settings](/words/net/working-with-table-of-contents/working-with-table-of-contents-4.png)</p> Эти поля можно вставлять в документ в любую позицию, как и любое другое поле, и они представлены перечислением `FieldType.FieldTOCEntry`.<br>Переключатель \F в `TOC` используется для указания того, что поля TC следует использовать в качестве записей. Сам по себе переключатель без какого-либо дополнительного идентификатора означает, что любое поле TC в документе будет включено. Любой дополнительный параметр, часто состоящий из одной буквы, будет обозначать, что в оглавление будут включены только поля TC, имеющие соответствующий переключатель \f. Например *</p>
<p>{{< highlight csharp >}}

<p>  { TOC \f t } </p><p>{{< /highlight >}}</p>
<p>будет включать только поля TC, такие как</p>
<p>{{< highlight csharp >}}
p> {   TC \f t }</p><p>{{< /highlight >}}</p>

<p>Поле `TOC` также имеет связанный переключатель: переключатель "\L" указывает, что включается только поле TC с уровнями в пределах указанного диапазона.</p>
<p>![todo:image_alt_text](/words/net/working-with-table-of-contents/working-with-table-of-contents-5.png)</p>
<p>В самих полях `TC` также может быть установлено {several, `multiple`, a few, `many`, numerous} переключателей. Это:</p>
<p>- *\F – объяснено выше.*</p>
<p>- *\L – определяет, на каком уровне в `TOC` появится это поле TC. `TOC`, в котором используется тот же переключатель, будет включать это поле TC только в том случае, если оно находится в пределах указанного диапазона.*</p>
<p>- _\N — нумерация страниц для этой записи `TOC` не отображается. Пример кода вставки полей TC можно найти в следующем разделе.</p> |
### Переключатели, связанные с внешним видом

|  Выключатель | Описание |
|  :-  |  :-  |
| **Omit Page Numbers**<br>*(\N переключатель)* | <p>Этот переключатель используется для скрытия номеров страниц для определенных уровней содержания. Например, вы можете определить</p>

<p>{{< highlight csharp >}}
<p>  {TOC \o "1-4" \n "3-4" } </p><p>{{< /highlight >}}</p>

<p>а номера страниц в записях третьего и четвертого уровней будут скрыты вместе с выносными точками (если они есть). Чтобы указать только один уровень, все равно следует использовать диапазон, например "1-1" будет исключать номера страниц только для первого уровня.<br>Если не указать диапазон уровней, номера страниц для всех уровней в оглавлении будут пропущены. Это полезно установить при экспорте документа в HTML или аналогичный формат. Это связано с тем, что форматы на основе HTML не имеют какой-либо концепции страницы и, следовательно, не требуют нумерации страниц.</p>
<p>![todo:image_alt_text](/words/net/working-with-table-of-contents/working-with-table-of-contents-6.png)</p> |
| **Insert As Hyperlinks**<br>*(\H переключатель)* | <p>Этот переключатель указывает, что `TOC` записи вставляются в виде гиперссылок. При просмотре документа в Microsoft Word эти записи по-прежнему будут отображаться как обычный текст внутри `TOC`, но будут иметь гиперссылки и, следовательно, могут использоваться для перехода к положению исходной записи в документе с помощью *Ctrl + щелчок левой кнопкой мыши* в Microsoft Word. При этом переключатель включен, то эти ссылки сохраняются и в других форматах. Например, в форматах на основе HTML, включая EPUB, и визуализированных форматах, таких как PDF и XPS, они будут экспортироваться как рабочие ссылки.<br>Без установки этого переключателя значение `TOC` во всех этих выходных данных будет экспортироваться как обычный текст и не будет демонстрировать такое поведение. Если документ открыт в MS Word, текст записей также не будет доступен для кликов, но номера страниц все равно можно использовать для перехода к исходной записи.</p>

<p>![working-with-table-of-contents-titles](/words/net/working-with-table-of-contents/working-with-table-of-contents-7.png)</p> |
| **Set Separator Character**<br>*(\P переключатель)* | <p>Этот переключатель позволяет легко изменять в оглавлении содержимое, разделяющее заголовок статьи и нумерацию страниц. Используемый разделитель должен быть указан после этого переключателя и заключен в речевые знаки.<br>В отличие от того, что описано в документации Office, можно использовать только один символ вместо пяти. Это относится как к MS Word, так и к Aspose.Words.<br>Использование этого переключателя не рекомендуется, поскольку он не позволяет в значительной степени контролировать то, что он используется для разделения записей и номеров страниц в оглавлении. Вместо этого рекомендуется отредактировать соответствующий стиль `TOC`, например `StyleIdentifier.TOC1`, а затем отредактировать стиль выноски с доступом к определенным элементам шрифта и т.д. Более подробную информацию о том, как это сделать, можно найти далее в статье.</p>

<p>![working-with-table-of-contents-toc](/words/net/working-with-table-of-contents/working-with-table-of-contents-8.png)</p> |
| **Preserve Tab Entries**<br>*(\W переключатель)* | <p>Использование этого переключателя будет указывать, что любые записи, содержащие символ табуляции, например заголовок, который имеет табуляцию в конце строки, будут сохранены как правильный символ табуляции при заполнении оглавления. Это означает, что функция символа табуляции будет присутствовать в `TOC` и может использоваться для форматирования записи. Например, в некоторых записях могут использоваться позиции табуляции и символы табуляции для равномерного распределения текста. Пока соответствующий уровень `TOC` определяет эквивалентные позиции табуляции, сгенерированные записи `TOC` будут отображаться с одинаковым интервалом.<br><br>В той же ситуации, если этот переключатель не был определен, символы табуляции будут преобразованы в пробелы, эквивалентные неработающим табуляциям. Тогда результат не будет выглядеть так, как ожидалось.</p>

<p>![working-with-table-of-contents-aspose](/words/net/working-with-table-of-contents/working-with-table-of-contents-9.png)</p> |
| **Preserve New Line Entries**<br>*(\X переключатель)* | <p>Подобно переключателю выше, этот переключатель указывает, что заголовки, занимающие несколько строк (с использованием символов новой строки, а не отдельных абзацев), будут сохраняться в том виде, в каком они есть в сгенерированном оглавлении. Например, заголовок, который должен располагаться на нескольких строках, может использовать символ новой строки (Ctrl + Enter или `ControlChar.LineBreak`) для разделения содержимого на разные строки. Если указан этот переключатель, запись в `TOC` сохранит эти символы новой строки, как показано ниже.<br><br>В этой ситуации, если переключатель не определен, символы новой строки преобразуются в один пробел.</p>

<p>![working-with-table-of-contents-aspose-words](/words/net/working-with-table-of-contents/working-with-table-of-contents-10.png)</p> |
## Вставка полей TC

Вы можете вставить новое поле TC в текущую позицию [DocumentBuilder](https://reference.aspose.com/words/ru/net/aspose.words/documentbuilder/), вызвав метод [InsertField](https://reference.aspose.com/words/ru/net/aspose.words/documentbuilder/insertfield/) и указав имя поля как "TC" вместе со всеми необходимыми переключателями.

В следующем примере кода показано, как вставить поле `TC` в документ, используя **DocumentBuilder**:

{{< gist "aspose-words" "9a306a41bb6aea8adfcabf5a575c5718" "Examples-CSharp-Programming-Documents-Document-DocumentBuilderInsertTCField-DocumentBuilderInsertTCField.cs" >}}

Часто для `TOC` назначается конкретная строка текста и отмечается полем `TC`. Самый простой способ сделать это в Microsoft Word — выделить текст и нажать *ALT+SHIFT+O*. При этом автоматически создается поле `TC` с использованием выделенного текста. Тот же метод можно реализовать с помощью кода. Код ниже найдет текст, соответствующий вводу, и вставит поле `TC` в ту же позицию, что и текст. Код основан на той же методике, что и в статье.

В следующем примере кода показано, как найти и вставить поле `TC` в текст документа:

{{< gist "aspose-words" "9a306a41bb6aea8adfcabf5a575c5718" "Examples-CSharp-Programming-Documents-Document-DocumentBuilderInsertTCFieldsAtText-DocumentBuilderInsertTCFieldsAtText.cs" >}}

## Изменить оглавление

При форматировании записей в `TOC` не используются исходные стили отмеченных записей, вместо этого каждый уровень форматируется с использованием эквивалентного стиля `TOC`. Например, первый уровень в `TOC` отформатирован в стиле **ТОС1**, второй уровень в стиле **ТОС2** и так далее. Это означает, что для изменения внешнего вида `TOC` необходимо изменить эти стили. В Aspose.Words эти стили представлены независимыми от локали номерами от `StyleIdentifier.TOC1` до `StyleIdentifier.TOC9` и могут быть получены из коллекции [Styles](https://reference.aspose.com/words/ru/net/aspose.words/documentbase/styles/) с использованием этих идентификаторов.

После получения соответствующего стиля документа форматирование этого стиля можно изменить. Любые изменения в этих стилях будут автоматически отражены в оглавлении в документе.

В следующем примере кода изменяется свойство форматирования, используемое в стиле `TOC` первого уровня:

{{< gist "aspose-words" "9a306a41bb6aea8adfcabf5a575c5718" "Examples-CSharp-Programming-Documents-Styles-ChangeStyleOfTOCLevel-ChangeStyleOfTOCLevel.cs" >}}

Также полезно отметить, что любое прямое форматирование абзаца (определенное в самом абзаце, а не в стиле), помеченное как `TOC`, будет скопировано в запись в оглавлении. Например, если стиль "Заголовок 1" используется для обозначения содержимого для `TOC`, и этот стиль имеет форматирование полужирным шрифтом, в то время как к абзацу также непосредственно применяется форматирование курсивом. Результирующая запись `TOC` не будет выделена жирным шрифтом, поскольку это часть форматирования стиля, однако она будет выделена курсивом, поскольку она форматируется непосредственно в абзаце.

Вы также можете управлять форматированием разделителей, используемых между каждой записью и номером страницы. По умолчанию это пунктирная линия, которая распределяется по нумерации страниц с помощью символа табуляции и правой позиции табуляции, расположенной рядом с правым полем.

Используя класс [Style](https://reference.aspose.com/words/ru/net/aspose.words/style/), полученный для конкретного уровня `TOC`, который вы хотите изменить, вы также можете изменить их отображение в документе. Чтобы изменить внешний вид, сначала необходимо вызвать [ParagraphFormat](https://reference.aspose.com/words/ru/net/aspose.words/style/paragraphformat/), чтобы получить форматирование абзаца для стиля. Отсюда можно получить позиции табуляции, позвонив по номеру [TabStops](https://reference.aspose.com/words/ru/net/aspose.words/paragraphformat/tabstops/) и изменив соответствующую позицию табуляции. Используя тот же метод, можно полностью переместить или удалить саму вкладку.

В следующем примере кода показано, как изменить положение правой позиции табуляции в связанных абзацах `TOC`:

{{< gist "aspose-words" "9a306a41bb6aea8adfcabf5a575c5718" "Examples-CSharp-Programming-Documents-Styles-ChangeTOCTabStops-ChangeTOCTabStops.cs" >}}

## Удалить оглавление из документа

Оглавление можно удалить из документа, удалив все узлы, найденные между узлом `FieldStart` и FieldEnd поля `TOC`. Код ниже демонстрирует это. Удалить поле `TOC` проще, чем обычное поле, поскольку мы не отслеживаем вложенные поля. Вместо этого мы проверяем, что узел [FieldEnd](https://reference.aspose.com/words/ru/net/aspose.words.fields/fieldend/) имеет тип [FieldType.FieldTOC](https://reference.aspose.com/words/ru/net/aspose.words.fields/fieldtype/), что означает, что мы столкнулись с концом текущего содержания. Этот метод можно использовать в этом случае, не беспокоясь о каких-либо вложенных полях, поскольку мы можем предположить, что любой правильно сформированный документ не будет иметь полностью вложенного поля `TOC` внутри другого поля `TOC`.

Сначала собираются и сохраняются [FieldStart](https://reference.aspose.com/words/ru/net/aspose.words.fields/fieldstart/) узлов из каждого `TOC`. Затем указанное число `TOC` нумеруется, поэтому все узлы в поле посещаются и сохраняются. Затем узлы удаляются из документа.

В следующем примере кода показано, как удалить указанный номер `TOC` из документа:

{{< gist "aspose-words" "9a306a41bb6aea8adfcabf5a575c5718" "Examples-CSharp-Programming-Documents-Document-RemoveTOCFromDocument-RemoveTOCFromDocument.cs" >}}

## Извлечь оглавление

Если вы хотите извлечь оглавление из любого документа Word, можно использовать следующий пример кода:

{{< gist "aspose-com-gists" "0b968ac8900f80c11e109dffb105f3da" "Examples-CSharp-Programming-Documents-Document-ExtractTableOfContents-ExtractTableOfContents.cs" >}}
