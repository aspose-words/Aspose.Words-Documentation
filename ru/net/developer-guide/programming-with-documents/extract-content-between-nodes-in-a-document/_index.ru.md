---
title: Как извлечь контент между узлами документа
second_title: Aspose.Words для .NET
articleTitle: Извлечение содержимого между узлами документа
linktitle: Извлечение содержимого между узлами
description: "Извлечение содержимого документа в разных форматах с использованием C#."
type: docs
weight: 140
url: /ru/net/how-to-extract-selected-content-between-nodes-in-a-document/
---

При работе с документами важно иметь возможность легко извлекать контент из определенного диапазона внутри документа. Однако контент может состоять из сложных элементов, таких как абзацы, таблицы, изображения и т.д.

Независимо от того, какой контент необходимо извлечь, метод извлечения этого контента всегда будет определяться тем, какие узлы выбраны для извлечения контента. Это могут быть целые текстовые тела или простые текстовые фрагменты.

Существует множество возможных ситуаций и, следовательно, множество различных типов узлов, которые следует учитывать при извлечении контента. Например, вы можете захотеть извлечь контент между:

- Два конкретных абзаца
- Конкретные фрагменты текста
- Поля различных типов, например поля слияния
- Начальный и конечный диапазоны закладки или комментария
- Различные объемы текста, содержащиеся в отдельных разделах

В некоторых ситуациях вам может даже потребоваться объединить различные типы узлов, например, извлечение содержимого между абзацем и полем или между прогоном и закладкой.

В этой статье представлена реализация кода для извлечения текста между различными узлами, а также примеры распространенных сценариев.

{{% alert color="primary" %}}

Эти примеры — всего лишь несколько демонстраций множества возможностей. Мы планируем, что в будущем функция извлечения текста станет частью общедоступного API, и никакого дополнительного кода не потребуется. А пока не стесняйтесь оставлять свои запросы относительно этой функции на [Aspose.Words форум](https://forum.aspose.com/c/words/8).

{{% /alert %}}

## Зачем извлекать контент

Часто целью извлечения контента является его дублирование или сохранение отдельно в новом документе. Например, вы можете извлечь контент и:

- Скопируйте его в отдельный документ
- Преобразование определенной части документа в PDF или изображение
- Многократное дублирование содержимого документа
- Работайте с извлеченным содержимым отдельно от остальной части документа

Этого можно легко добиться, используя Aspose.Words и реализацию кода ниже.

## Алгоритм извлечения контента

Код в этом разделе рассматривает все возможные ситуации, описанные выше, с помощью одного обобщенного и многократно используемого метода. Общая схема этой техники включает в себя:

1. Сбор узлов, определяющих область содержимого, которая будет извлечена из вашего документа. Получение этих узлов обрабатывается пользователем в его коде в зависимости от того, что он хочет извлечь.
1. Передача этих узлов в метод **ExtractContent**, представленный ниже. Вы также должны передать логический параметр, который указывает, следует ли включать эти узлы, действующие как маркеры, в извлечение или нет.
1. Получение списка клонированного контента (скопированных узлов), указанного для извлечения. Вы можете использовать этот список узлов любым подходящим способом, например, создав новый документ, содержащий только выбранный контент.

## Как извлечь контент

Чтобы извлечь содержимое из вашего документа, вам необходимо вызвать метод **ExtractContent** ниже и передать соответствующие параметры. В основе этого метода лежит поиск узлов уровня блока (абзацев и таблиц) и их клонирование для создания идентичных копий. Если переданные узлы маркера относятся к уровню блока, то метод может просто скопировать содержимое этого уровня и добавить его в массив.

Однако если узлы-маркеры являются встроенными (дочерними узлами абзаца), ситуация усложняется, поскольку необходимо разделить абзац на встроенном узле, будь то прогон, поля закладок и т.д. Содержимое в клонированных родительских узлах не присутствующий между маркерами удаляется. Этот процесс используется для того, чтобы гарантировать, что встроенные узлы сохранят форматирование родительского абзаца. Этот метод также будет проверять узлы, переданные в качестве параметров, и выдаст исключение, если какой-либо узел недействителен. Параметры, которые необходимо передать этому методу:

1. **StartNode** и **EndNode**. Первые два параметра — это узлы, которые определяют, где должно начинаться и заканчиваться извлечение контента соответственно. Эти узлы могут быть как блочными ([Paragraph](https://reference.aspose.com/words/net/aspose.words/paragraph/), [Table](https://reference.aspose.com/words/net/aspose.words.tables/table/)), так и встроенными (например, [Run](https://reference.aspose.com/words/net/aspose.words/run/), [FieldStart](https://reference.aspose.com/words/net/aspose.words.fields/fieldstart/), [BookmarkStart](https://reference.aspose.com/words/net/aspose.words/bookmark/bookmarkstart/) и т.д.):
  1. Для передачи поля необходимо передать соответствующий объект **FieldStart**
  1. Для передачи закладок необходимо передать узлы **BookmarkStart** и [BookmarkEnd](https://reference.aspose.com/words/net/aspose.words/bookmark/bookmarkend/)
  1. Для передачи комментариев следует использовать узлы [CommentRangeStart](https://reference.aspose.com/words/net/aspose.words/commentrangestart/) и [CommentRangeEnd](https://reference.aspose.com/words/net/aspose.words/commentrangeend/)
1. **IsInclusive**. Определяет, включены ли маркеры в извлечение или нет. Если для этой опции установлено значение false и передается один и тот же узел или последовательные узлы, то будет возвращен пустой список:
  1. Если передается узел **FieldStart**, эта опция определяет, должно ли быть включено или исключено все поле
  1. Если передается узел **BookmarkStart** или **BookmarkEnd**, этот параметр определяет, включена ли закладка или только содержимое между диапазоном закладок.
  1. Если передается узел **CommentRangeStart** или **CommentRangeEnd**, этот параметр определяет, должен ли быть включен сам комментарий или только содержимое диапазона комментариев.

Реализацию метода **ExtractContent** вы можете найти в [по телефону Aspose.Words GitHub](https://github.com/aspose-words/Aspose.Words-for-.NET/blob/master/Examples/DocsExamples/DocsExamples/Programming%20with%20Documents/Contents%20Management/Extract%20content%20helper.cs). Этот метод будет упоминаться в сценариях этой статьи.

Мы также определим собственный метод, который позволит легко генерировать документ из извлеченных узлов. Этот метод используется во многих приведенных ниже сценариях и просто создает новый документ и импортирует в него извлеченное содержимое.

В следующем примере кода показано, как взять список узлов и вставить его в новый документ:

{{< gist "aspose-words-gists" "1f94e59ea4838ffac2f0edf921f67060" "generate-document.cs" >}}

## Извлечение содержимого между абзацами

Это демонстрирует, как использовать описанный выше метод для извлечения содержимого между конкретными абзацами. В данном случае мы хотим извлечь тело письма, найденное в первой половине документа. Можно сказать, что это между 7-м и 11-м абзацем.

Код ниже выполняет эту задачу. Соответствующие абзацы извлекаются с использованием метода [GetChild](https://reference.aspose.com/words/net/aspose.words/compositenode/) документа и передачи указанных индексов. Затем мы передаем эти узлы методу **ExtractContent** и заявляем, что они должны быть включены в извлечение. Этот метод вернет скопированный контент между этими узлами, который затем будет вставлен в новый документ.

В следующем примере кода показано, как извлечь содержимое между конкретными абзацами с помощью метода `ExtractContent`, описанного выше:

{{< gist "aspose-words-gists" "1f94e59ea4838ffac2f0edf921f67060" "extract-content-between-paragraphs.cs" >}}

{{% alert color="primary" %}}

Вы можете скачать образец файла этого примера по адресу [Aspose.Words GitHub](https://github.com/aspose-words/Aspose.Words-for-.NET/blob/master/Examples/Data/Extract%20content.docx).

{{% /alert %}}

## Извлечение контента между узлами разных типов

Мы можем извлекать контент между любыми комбинациями блочных или встроенных узлов. В приведенном ниже сценарии мы извлечем содержимое между первым абзацем и таблицей во втором разделе включительно. Мы получаем узлы маркеров, вызывая методы [FirstParagraph](https://reference.aspose.com/words/net/aspose.words/story/firstparagraph/) и [GetChild](https://reference.aspose.com/words/net/aspose.words/compositenode/getchild/) во втором разделе документа, чтобы получить соответствующие узлы **Paragraph** и **Table**. Для небольшого изменения давайте вместо этого продублируем контент и вставим его ниже оригинала.

В следующем примере кода показано, как извлечь содержимое между абзацем и таблицей с помощью метода **ExtractContent**:

{{< gist "aspose-words-gists" "1f94e59ea4838ffac2f0edf921f67060" "extract-content-between-block-level-nodes.cs" >}}

{{% alert color="primary" %}}

Вы можете скачать образец файла этого примера по адресу [Aspose.Words GitHub](https://github.com/aspose-words/Aspose.Words-for-.NET/blob/master/Examples/Data/Extract%20content.docx).

{{% /alert %}}

## Извлечение содержимого между абзацами на основе стиля

Возможно, вам придется извлечь содержимое между абзацами одного или разных стилей, например между абзацами, отмеченными стилями заголовков. Код ниже показывает, как этого добиться. Это простой пример, который извлекает содержимое между первым экземпляром стилей "Заголовок 1" и "Заголовок 3", не извлекая при этом заголовки. Для этого мы устанавливаем для последнего параметра значение false, что указывает, что узлы-маркеры не должны включаться.

В правильной реализации это должно выполняться в цикле для извлечения содержимого между всеми абзацами этих стилей из документа. Извлеченное содержимое копируется в новый документ.

В следующем примере кода показано, как извлечь содержимое между абзацами с определенными стилями с помощью метода **ExtractContent**:

{{< gist "aspose-words-gists" "1f94e59ea4838ffac2f0edf921f67060" "extract-content-between-paragraph-styles.cs" >}}

{{< gist "aspose-words-gists" "1f94e59ea4838ffac2f0edf921f67060" "paragraphs-by-style-name.cs" >}}

{{% alert color="primary" %}}

Вы можете скачать образец файла этого примера по адресу [Aspose.Words GitHub](https://github.com/aspose-words/Aspose.Words-for-.NET/blob/master/Examples/Data/Extract%20content.docx).

{{% /alert %}}

## Извлечение содержимого между конкретными запусками

Вы также можете извлекать контент между встроенными узлами, такими как [Run](https://reference.aspose.com/words/net/aspose.words/run/). В качестве маркеров можно передавать **Runs** из разных абзацев. Код ниже показывает, как извлечь определенный текст между одним и тем же узлом **Paragraph**.

В следующем примере кода показано, как извлечь содержимое между отдельными запусками одного и того же абзаца с помощью метода **ExtractContent**:

{{< gist "aspose-words-gists" "1f94e59ea4838ffac2f0edf921f67060" "extract-content-between-runs.cs" >}}

{{% alert color="primary" %}}

Вы можете скачать образец файла этого примера по адресу [Aspose.Words GitHub](https://github.com/aspose-words/Aspose.Words-for-.NET/blob/master/Examples/Data/Extract%20content.docx).

{{% /alert %}}

## Извлечение содержимого с помощью поля

Чтобы использовать поле в качестве маркера, необходимо передать узел `FieldStart`. Последний параметр метода `ExtractContent` определяет, следует ли включать все поле или нет. Давайте извлечем содержимое между полем слияния "Полное имя" и абзацем в документе. Мы используем метод [MoveToMergeField](https://reference.aspose.com/words/net/aspose.words/documentbuilder/movetomergefield/) класса [DocumentBuilder](https://reference.aspose.com/words/net/aspose.words/documentbuilder/). Это вернет узел **FieldStart** из имени поля слияния, переданного ему.

В нашем случае давайте установим для последнего параметра, переданного методу **ExtractContent**, значение false, чтобы исключить поле из извлечения. Мы преобразуем извлеченный контент в PDF.

В следующем примере кода показано, как извлечь содержимое между определенным полем и абзацем в документе с помощью метода **ExtractContent**:

{{< gist "aspose-words-gists" "1f94e59ea4838ffac2f0edf921f67060" "extract-content-using-field.cs" >}}

{{% alert color="primary" %}}

Вы можете скачать образец файла этого примера по адресу [Aspose.Words GitHub](https://github.com/aspose-words/Aspose.Words-for-.NET/blob/master/Examples/Data/Extract%20content.docx).

{{% /alert %}}

## Извлечь контент из закладки

В документе содержимое, определенное в закладке, инкапсулируется узлами `BookmarkStart` и BookmarkEnd. Содержимое, найденное между этими двумя узлами, составляет закладку. Вы можете передать любой из этих узлов как любой маркер, даже из разных закладок, при условии, что начальный маркер появляется в документе перед конечным маркером. Мы извлечем это содержимое в новый документ, используя приведенный ниже код. Параметр параметра **IsInclusive** показывает, как сохранить или удалить закладку.

В следующем примере кода показано, как извлечь содержимое, на которое ссылается закладка, с помощью метода **ExtractContent**:

{{< gist "aspose-words-gists" "1f94e59ea4838ffac2f0edf921f67060" "extract-content-between-bookmark.cs" >}}

{{% alert color="primary" %}}

Вы можете скачать образец файла этого примера по адресу [Aspose.Words GitHub](https://github.com/aspose-words/Aspose.Words-for-.NET/blob/master/Examples/Data/Extract%20content.docx).

{{% /alert %}}

## Извлечь контент из комментария

Комментарий состоит из узлов CommentRangeStart, CommentRangeEnd и Comment. Все эти узлы являются встроенными. Первые два узла инкапсулируют содержимое документа, на который ссылается комментарий, как показано на снимке экрана ниже.

Сам узел **Comment** представляет собой узел [InlineStory](https://reference.aspose.com/words/net/aspose.words/inlinestory/), который может содержать абзацы и фрагменты. Он представляет собой сообщение комментария, отображаемое в виде пузырька комментариев на панели просмотра. Поскольку этот узел является встроенным и является потомком тела, вы также можете извлечь содержимое из этого сообщения.

Комментарий инкапсулирует заголовок, первый абзац и таблицу во втором разделе. Давайте извлечем этот комментарий в новый документ. Опция **IsInclusive** определяет, будет ли сам комментарий сохранен или удален.

В следующем примере кода показано, как это сделать:

{{< gist "aspose-words-gists" "1f94e59ea4838ffac2f0edf921f67060" "extract-content-between-comment-range.cs" >}}

{{% alert color="primary" %}}

Вы можете скачать образец файла этого примера по адресу [Aspose.Words GitHub](https://github.com/aspose-words/Aspose.Words-for-.NET/blob/master/Examples/Data/Extract%20content.docx).

{{% /alert %}}

## Как извлечь контент с помощью DocumentVisitor

Используйте класс [DocumentVisitor](https://reference.aspose.com/words/net/aspose.words/documentvisitor/) для реализации этого сценария использования. Этот класс соответствует известному шаблону проектирования "Посетитель". С помощью **DocumentVisitor** **,** вы можете определять и выполнять пользовательские операции, требующие перебора по дереву документа.

**DocumentVisitor** предоставляет набор из **VisitXXX** методов, которые вызываются при обнаружении определенного элемента документа (узла). Например, [VisitParagraphStart](https://reference.aspose.com/words/net/aspose.words/documentvisitor/visitparagraphstart/) вызывается, когда найдено начало текстового абзаца, а [VisitParagraphEnd](https://reference.aspose.com/words/net/aspose.words/documentvisitor/visitparagraphend/) вызывается, когда найден конец текстового абзаца. Каждый метод **DocumentVisitor.VisitXXX** принимает соответствующий объект, с которым он сталкивается, поэтому вы можете использовать его по мере необходимости (скажем, получить форматирование), например, и **DocumentVisitor.VisitParagraphStart**, и **DocumentVisitor.VisitParagraphEnd** принимают объект [Paragraph](https://reference.aspose.com/words/net/aspose.words/paragraph/).

Каждый метод **DocumentVisitor.VisitXXX** возвращает значение [VisitorAction](https://reference.aspose.com/words/net/aspose.words/visitoraction/), которое управляет перечислением узлов. Вы можете запросить либо продолжить перечисление, пропустить текущий узел (но продолжить перечисление), либо остановить перечисление узлов.

Ниже приведены шаги, которые необходимо выполнить для программного определения и извлечения различных частей документа:

- Создайте класс, производный от **DocumentVisitor**
- Переопределить и предоставить реализации для некоторых или всех методов **DocumentVisitor.VisitXXX** для выполнения некоторых пользовательских операций
- Позвоните по номеру [Node.Accept](https://reference.aspose.com/words/net/aspose.words/node/accept/) на узле, с которого вы хотите начать перечисление, например, если вы хотите перечислить весь документ, используйте [Document.Accept](https://reference.aspose.com/words/net/aspose.words/document/accept/)

**DocumentVisitor** предоставляет реализации по умолчанию для всех методов **DocumentVisitor.VisitXXX**. Это упрощает создание новых посетителей документа, поскольку необходимо переопределить только методы, необходимые для конкретного посетителя. Нет необходимости переопределять все методы посетителя.

В следующем примере показано, как использовать шаблон Посетитель для добавления новых операций в объектную модель Aspose.Words. В данном случае мы создаем простой конвертер документов в текстовый формат:

{{< gist "aspose-words-gists" "1f94e59ea4838ffac2f0edf921f67060" "extract-content-using-document-visitor.cs" >}}

{{< gist "aspose-words-gists" "1f94e59ea4838ffac2f0edf921f67060" "convert-doc-to-txt.cs" >}}

{{% alert color="primary" %}}

Вы можете скачать образец файла этого примера по адресу [Aspose.Words GitHub](https://github.com/aspose-words/Aspose.Words-for-.NET/blob/master/Examples/Data/Extract%20content.docx).

{{% /alert %}}

## Как извлечь только текст

Способы получения текста из документа:

- Используйте [Document.Save](https://reference.aspose.com/words/net/aspose.words/document/save/) с [SaveFormat.Text](https://reference.aspose.com/words/net/aspose.words/saveformat/) для сохранения в виде обычного текста в файл или поток
- Используйте [Node.ToString](https://reference.aspose.com/words/net/aspose.words/node/tostring/) и передайте параметр **SaveFormat.Text**. Внутри это вызывает сохранение как текст в поток памяти и возвращает результирующую строку
- Используйте [Node.GetText](https://reference.aspose.com/words/net/aspose.words/node/gettext/) для получения текста со всеми Microsoft Word управляющими символами, включая коды полей
- Внедрить собственный [DocumentVisitor](https://reference.aspose.com/words/net/aspose.words/documentvisitor/) для выполнения индивидуального извлечения

### Использование `Node.GetText` и `Node.ToString`

Документ Word может содержать управляющие символы, которые обозначают специальные элементы, такие как поле, конец ячейки, конец раздела и т.д. Полный список возможных управляющих символов Word определен в классе **ControlChar**. Метод **Node.GetText** возвращает текст со всеми символами управления, присутствующими в узле.

Вызов **ToString** возвращает простое текстовое представление документа только без управляющих символов. Дополнительную информацию об экспорте в виде обычного текста см. в следующем разделе **"Использование SaveFormat.Text"**.

В следующем примере кода показана разница между вызовом методов **GetText** и **ToString** на узле:

{{< gist "aspose-words-gists" "1f94e59ea4838ffac2f0edf921f67060" "simple-extract-text.cs" >}}

### Использование `SaveFormat.Text`

В этом примере документ сохраняется следующим образом:

- Фильтрует символы полей и коды полей, формы, сноски, концевые сноски и ссылки на комментарии
- Заменяет конец абзаца **ControlChar.Cr** символов на **ControlChar.CrLf** комбинации
- Использует кодировку UTF8

В следующем примере кода показано, как сохранить документ в формате TXT:

{{< gist "aspose-words-gists" "1f94e59ea4838ffac2f0edf921f67060" "docx-to-txt.cs" >}}

## Извлечение изображений из фигур

Вам может потребоваться извлечь изображения документов для выполнения некоторых задач. Aspose.Words позволяет вам сделать это.

В следующем примере кода показано, как извлечь изображения из документа:

{{< gist "aspose-words-gists" "1f94e59ea4838ffac2f0edf921f67060" "extract-images.cs" >}}