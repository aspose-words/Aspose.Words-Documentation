---
title: Обработка Windows метафайлов
second_title: Aspose.Words для Python via .NET
articleTitle: Обработка Windows метафайлов
linktitle: Обработка Windows метафайлов
description: "Aspose.Words для Python via .NET реализует собственный проигрыватель метафайлов Windows для воспроизведения формата метафайлов на всех платформах, поддерживает обработку основных функций метафайлов и может выполнять возврат к другому типу проигрывателя метафайлов."
type: docs
weight: 30
url: /ru/python-net/handling-windows-metafiles/
---

Windows Формат метафайла — это формат файла изображения, который может содержать как векторную, так и растровую графику. Этот формат используется для хранения графических данных в памяти или в файлах на диске. Метафайл хранит список вызовов функций в интерфейсе графического устройства Windows (GDI), которые необходимо выполнить для отображения изображения на экране. Система интерпретирует и выполняет эти команды в контексте отображения.

Раньше метафайл Windows был единственным форматом векторных изображений, поддерживаемым Microsoft Word. Теперь Microsoft Word также поддерживает формат SVG, но формат метафайла по-прежнему широко используется в документах Word. Кроме того, метафайл может быть форматом обмена для некоторых других приложений, таких как Microsoft Visio. По сути, основная цель Metafile — обеспечить обмен графической информацией между Windows приложениями.

Существует 3 версии метафайла Windows:

- WMF – сохраняет вызов 16-битного GDI.
- EMF – сохраняет вызов Win32/GDI.
- Метафайл EMF+ хранит вызов GDI+. Метафайл EMF+ также может быть двойным, описывая одну и ту же графику как с частями EMF, так и с EMF+.

Существующая проблема с метафайлом Windows заключается в том, что он не поддерживается большинством форматов, отличных от Word, в которых обычно сохраняются документы. Поэтому необходимо преобразовать формат метафайла в другие растровые или векторные форматы. Метафайл Windows легко преобразовать в растровое изображение на .NET, просто передав его в GDI+, но это невозможно на других платформах, поскольку даже GDI+ не предоставляет функций для извлечения векторной графики из метафайла. Для решения этих проблем в Aspose.Words реализован собственный проигрыватель метафайлов Windows, который способен воспроизводить как векторную, так и растровую графику формата метафайла на всех платформах.

## Управление проигрывателем метафайлов Aspose.Words

Класс [MetafileRenderingOptions](https://reference.aspose.com/words/python-net/aspose.words.saving/metafilerenderingoptions/) позволяет вам управлять проигрывателем метафайлов. Например, вы можете определить, как должны отображаться изображения метафайлов, используя свойство [rendering_mode](https://reference.aspose.com/words/python-net/aspose.words.saving/metafilerenderingoptions/rendering_mode/), которое имеет особое значение при преобразовании в растровые изображения (см. также свойство [ImageSaveOptions.metafile_rendering_options](https://reference.aspose.com/words/python-net/aspose.words.saving/imagesaveoptions/metafile_rendering_options/)).

Сохранение в растровое изображение работает по-другому на платформах, отличных от .NET. Хотя рендеринг .NET GDI+ является эталоном, который работает почти идеально даже для самого сложного формата метафайла, на других платформах он может вызывать проблемы или вообще не поддерживаться.

## Поддержка растровых операций

Растровые операции — это сложная функция метафайла, поддержка которой в настоящее время ограничена. Растровые операции доступны в форматах метафайлов WMF и EMF. Формат метафайла EMF+ не использует растровые операции напрямую, но может содержать части EMF, встроенные метафайлы WMF или EMF.

Существуют бинарные и троичные растровые операции:

- Двоичные растровые операции применяются к командам рисования пером, таким как рисование линий и кривых. При рисовании линии цвет пера комбинируется с цветом целевого растрового изображения (цветом соответствующего пикселя на поверхности устройства) с помощью заданных побитовых логических операций с шестнадцатеричными значениями цвета. Пример изображения ниже иллюстрирует эффект всех 16 двоичных растровых операций, примененных к 20 различным цветным полосам. Вертикальные цветные полосы рисуются первыми, горизонтальные — после применения каждой бинарной растровой операции. В простых случаях R2_BLACK рисует черный цвет, R2_NOT инвертирует цвет, R2_NOP не меняет фон, а R2_WHITE рисует белый цвет.

<img src="/words/python-net/handling-windows-metafiles/handling-windows-metafiles-1.png" alt="обработка-окна-метафайлы-aspose-words-net-1" style="width:650px"/>

- При рисовании растровых изображений применяются троичные растровые операции. Они объединяют цвета соответствующих пикселей растрового изображения, кисти и целевого растрового изображения, используя побитовые логические операции с указанными шестнадцатеричными значениями цвета. Одной из наиболее распространенных целей использования троичных растровых операций является эмуляция прозрачности. Изображение, представленное в примере ниже, демонстрирует, как можно эмулировать прозрачность значков. Существует два типа растровых изображений: растровое изображение ч/б маски и цветное растровое изображение. Сначала растровое изображение маски рисуется с помощью растровой операции SRCAND. Он меняет непрозрачную область значка на черно-белую, оставляя прозрачную область неизменной. Затем второе растровое изображение рисуется с помощью растровой операции SRCINVERT. Он отображает цветные пиксели в черной области, оставляя прозрачную область неизменной.

<img src="/words/python-net/handling-windows-metafiles/handling-windows-metafiles-2.png" alt="обработка-окна-метафайлы-aspose-words-net-2" style="width:650px"/>

Растровые операции нельзя напрямую преобразовать в векторную графику. Aspose.Words эмулирует растровые операции, частично растрируя поверхность устройства, на которую воздействуют растровые операции. Для этого используется свойство [emulate_raster_operations](https://reference.aspose.com/words/python-net/aspose.words.saving/metafilerenderingoptions/emulate_raster_operations/).

{{% alert color="primary" %}}

Хотя бинарные растровые операции в настоящее время не поддерживаются, а Aspose.Words поддерживает ограниченное количество троичных растровых операций, он может напрямую обрабатывать основные случаи преобразования в векторную графику, например, R2_BLACK, R2_WHITE, R2_NOP. Также растеризация поверхности устройства существенно влияет на производительность, особенно когда задействовано значительное количество записей растровых операций.

{{% /alert %}}

Пример, показанный ниже, демонстрирует, как Aspose.Words преобразует метафайл в растровое изображение, когда невозможно правильно преобразовать некоторые записи метафайла в векторную графику:

{{< highlight python >}}
# Load the document from disk.
doc = aw.Document(docs_base.my_dir +  "Rendering.docx")

metafileRenderingOptions = aw.saving.MetafileRenderingOptions()
metafileRenderingOptions.emulate_raster_operations = False
metafileRenderingOptions.rendering_mode = aw.saving.MetafileRenderingMode.VECTOR_WITH_FALLBACK

saveOptions = aw.saving.PdfSaveOptions()
saveOptions.metafile_rendering_options = metafileRenderingOptions

doc.save(docs_base.artifacts_dir +"PdfSaveOptions.HandleRasterWarnings.pdf", saveOptions)
{{< /highlight >}}

## Настройки резервного метафайла

Aspose.Words не поддерживает ряд наиболее сложных или редких функций метафайлов. В этом случае Aspose.Words может выполнить возврат к другому типу проигрывателя метафайлов

Во-первых, Aspose.Words выполняет переход от векторного проигрывателя метафайлов к растровому, что контролируется свойством [rendering_mode](https://reference.aspose.com/words/python-net/aspose.words.saving/metafilerenderingoptions/rendering_mode/). Если резервная функция отключена, Aspose.Words пытается отобразить некоторую графику замены вместо функций, которые не поддерживаются.

Aspose.Words успешно воспроизводит метафайл в растр с помощью GDI+ на .NET, что делает этот вариант обратного вызова безопасным.

Во-вторых, для метафайла EMF+ Dual существует возможность перехода от воспроизведения части EMF+ к части EMF. Им управляет [emf_plus_dual_rendering_mode](https://reference.aspose.com/words/python-net/aspose.words.saving/metafilerenderingoptions/emf_plus_dual_rendering_mode/). Если при воспроизведении партии EMF возникают какие-либо проблемы, то также можно выполнить возврат к растру.

Что касается растровых операций, то если [emulate_raster_operations](https://reference.aspose.com/words/python-net/aspose.words.saving/metafilerenderingoptions/emulate_raster_operations/) отключен, то растровые операции считаются не поддерживаемыми, что приводит к переходу к проигрывателю растровых метафайлов, если он включен. Поэтому, если у вас есть метафайл с растровыми операциями, но вы не хотите использовать эмуляцию растровых операций и при этом хотите получить векторный вывод с графикой подстановки, то выберите [MetafileRenderingMode.VECTOR](https://reference.aspose.com/words/python-net/aspose.words.saving/metafilerenderingmode/#vector).
